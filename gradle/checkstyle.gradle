checkstyle {
    toolVersion('8.20')
    configFile rootProject.file("gradle/checkstyle/checkstyle.xml")
    sourceSets = [project.sourceSets.main]
}

checkstyleMain.exclude '**/dto/**'
checkstyleMain.exclude '**/utils/**'
checkstyleMain.exclude '**/config/**'
checkstyleMain.exclude '**/DTO.java'
checkstyleMain.exclude '**/config.java**'
checkstyleMain.exclude '**/AdapterConstantsError.java**'
checkstyleMain.exclude '**/SpeiTransactionServiceApp.java**'
checkstyleMain.exclude '**/SpeiTransactionMapper.java**'

tasks.withType(Checkstyle).each { checkstyleTask ->
    checkstyleTask.doLast {

        reports.all { report ->
            def outputFile = report.destination
            if (outputFile.exists() && outputFile.text.contains("<error ")) {
                throw new GradleException("There were checkstyle warnings! For more info check $outputFile")
            }
        }
    }
}